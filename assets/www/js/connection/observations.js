// Generated by CoffeeScript 1.3.3
var ObservationFetcher, ObservationView, ObservationViewRendrer,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ObservationView = (function() {

  function ObservationView(author, title, updated, url, content) {
    this.author = author;
    this.title = title;
    this.updated = updated;
    this.url = url;
    this.content = content;
  }

  return ObservationView;

})();

ObservationFetcher = (function() {

  function ObservationFetcher() {
    this.getObservations = __bind(this.getObservations, this);

  }

  ObservationFetcher.prototype.getObservations = function(callback) {
    return jQuery.get("http://h-web01.nve.no/stage_regobsservices/Atom/AllRegistrationsV?$filter=LangKey%20eq%201%20and%20UTMEast%20gt%20240000%20and%20UTMEast%20lt%20250000%20and%20UTMNorth%20le%206660000%20and%20UTMNorth%20gt%206650000&$orderby=RegID%20desc").success(this.fetchedDataHandler(callback)).error(this.error);
  };

  ObservationFetcher.prototype.fetchedDataHandler = function(callback) {
    var _this = this;
    return function(data) {
      var obs, xml;
      xml = jQuery(data);
      obs = _this.entryToObservationView(xml.find("entry"));
      return callback(obs);
    };
  };

  ObservationFetcher.prototype.entryToObservationView = function(entrys) {
    return jQuery.map(entrys, function(e) {
      var author, content, entry, title, updated, url;
      entry = jQuery(e);
      author = entry.find("author").text().trim();
      title = entry.find("title").text().trim();
      updated = entry.find("updated").text().trim();
      url = entry.find("link").attr("href");
      content = entry.find("content")[0];
      return new ObservationView(author, title, updated, url, content);
    });
  };

  return ObservationFetcher;

})();

ObservationViewRendrer = (function() {

  function ObservationViewRendrer(domNode, listOfView) {
    this.domNode = domNode;
    this.listOfView = listOfView;
  }

  ObservationViewRendrer.prototype.render = function() {
    console.log(this.domNode);
    jQuery(this.domNode).html(Handlebars.templates.viewList({
      list: this.listOfView
    }));
    return console.log(jQuery(this.domNode));
  };

  ObservationViewRendrer.prototype.setListOfView = function(listOfView) {
    this.listOfView = listOfView;
  };

  return ObservationViewRendrer;

})();
